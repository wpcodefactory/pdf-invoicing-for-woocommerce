jQuery(document).ready(function($){$('.alg-wc-shortcode-field').each(function(){const shortcode_closest_element=$(this).parents().first().addClass('alg-wc-shortcode-wrap');let link=$('<a>',{href:'#',title:alg_wc_pdf_invoicing_admin_js.shortcodes_text,class:'alg-wc-shortcode-button button button-secondary',text:alg_wc_pdf_invoicing_admin_js.shortcodes_text});let icon=$('<span>',{class:'dashicons dashicons-arrow-down-alt2',});link.append(icon);shortcode_closest_element.append(link)});let shortcodes_list=alg_wc_pdf_invoicing_admin_js.shortcodes;const shortcode_list_class='.alg-wc-shortcode-list';$(document).on('click','.alg-wc-shortcode-button',function(e){e.preventDefault();let container=$(this).closest('.alg-wc-shortcode-wrap');$(shortcode_list_class).not(container.find(shortcode_list_class)).hide();if(container.find(shortcode_list_class).length){container.find(shortcode_list_class).toggle()}else{container.append(`${shortcodes_list}`);container.find(shortcode_list_class).toggle()}e.stopPropagation()});$(document).on('click',function(e){const shortcode_lists=$(shortcode_list_class);if(!shortcode_lists.is(e.target)&&0===shortcode_lists.has(e.target).length){shortcode_lists.hide()}});$(document).on('click','.alg-wc-shortcode-list li',function(){const shortcode=$(this).data('shortcode');const field_container=$(this).closest('.alg-wc-shortcode-wrap');const field_id=field_container.find('.alg-wc-shortcode-field').attr('id');const field=$(`[id="${field_id}"]`);if(!field.length){return}field.focus();const cursor_pos=field.prop('selectionStart');try{document.execCommand('insertText',false,shortcode)}catch(error){const field_value=field.val();field.val(field_value.substring(0,cursor_pos)+shortcode+field_value.substring(cursor_pos))}field.prop('selectionStart',cursor_pos+shortcode.length);field.prop('selectionEnd',cursor_pos+shortcode.length);if(typeof tinyMCE!=="undefined"){const editor=tinyMCE.get(field_id);if(editor){editor.execCommand('mceInsertContent',false,shortcode)}}});$(document).on('keyup','.alg-wc-shortcode-search',function(){let filter=$(this).val().toLowerCase();$(this).closest('.alg-wc-shortcode-list').find('li').filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(filter)>-1)})});function bindEditorChanges(editorContainer){const editorId=editorContainer.find('.wp-editor-area').attr('id');const $textarea=$(`#${editorId}`);if(typeof tinyMCE!=='undefined'){const editor=tinyMCE.get(editorId);if(editor){editor.on('change keyup',function(){editor.save();$textarea.trigger('input').trigger('change')})}}}$('.alg-wc-text-editor').each(function(){bindEditorChanges($(this))});$(document).on('tinymce-editor-init',function(e,editor){const container=$(`#${editor.id}`).closest('.alg-wc-text-editor');if(container.length){bindEditorChanges(container)}});$(document).on('click','.wp-switch-editor',function(){const container=$(this).closest('.alg-wc-text-editor');const editorId=container.find('.wp-editor-area').attr('id');$(`#${editorId}`).trigger('input').trigger('change')})});